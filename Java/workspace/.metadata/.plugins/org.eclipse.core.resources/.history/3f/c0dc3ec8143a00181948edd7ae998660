package com.jsyn.examples;

import jsyn.JSyn;
import jsyn.unitgen.LineOut;
import jsyn.unitgen.SineOscillator;

/**
 * Play a tone using a JSyn oscillator.
 * 
 * @author Phil Burk (C) 2010 Mobileer Inc
 */
public class PlayTone {
	com.jsyn.Synthesizer synth;
	SineOscillator osc;
	LineOut lineOut;

	private void test() {

		// Create a context for the synthesizer.
		synth = JSyn.createSynthesizer();

		// Start synthesizer using default stereo output at 44100 Hz.
		synth.start();

		// Add a tone generator.
		synth.add(osc = new SineOscillator());
		// Add a stereo audio output unit.
		synth.add(lineOut = new LineOut());

		// Connect the oscillator to both channels of the output.
		osc.output.connect(0, lineOut.input, 0);
		osc.output.connect(0, lineOut.input, 1);

		// Set the frequency and amplitude for the sine wave.
		osc.frequency.set(345.0);
		osc.amplitude.set(0.6);

		// We only need to start the LineOut. It will pull data from the
		// oscillator.
		lineOut.start();

		System.out.println("You should now be hearing a sine wave. ---------");

		// Sleep while the sound is generated in the background.
		try {
			double time = synth.getCurrentTime();
			System.out.println("time = " + time);
			// Sleep for a few seconds.
			int i = 345;
			int counter = 0;
			int lfo = 50;
			int upDown = 1;
			while (true) {
				counter = 0;
				i = 0;
				while (upDown > 0) {
					counter++;
					Thread.sleep(10);
					osc.frequency.set(i++ + 345);
					if (counter % lfo == 0) {
						upDown = -1;
					}
				}
				counter = 0;
				i = 0;
				while (upDown < 0) {
					counter++;
					Thread.sleep(10);
					osc.frequency.set(345 + lfo - i++);
					if (counter % lfo == 0) {
						upDown = 1;
					}
				}
			}

		}
		catch (InterruptedException e) {
			e.printStackTrace();
		}

		System.out.println("Stop playing. -------------------");
		// Stop everything.
		synth.stop();
	}

	public static void main(String[] args) {
		new PlayTone().test();
	}
}